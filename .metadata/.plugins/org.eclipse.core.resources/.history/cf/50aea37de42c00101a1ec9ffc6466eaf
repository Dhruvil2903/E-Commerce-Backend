package com.order.service;

import java.util.Optional;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import com.order.Entity.Order;
import com.order.customException.OrderAlreadyExist;
import com.order.customException.OrderNotFound;
import com.order.enumModel.OrderStatus;
import com.order.repository.OrderRepository;

@Service
public class OrderService {

	@Autowired
	private OrderRepository orderRepository;

	public Order addOrder(Order order) throws OrderAlreadyExist {
		Optional<Order> orderExist = orderRepository.findByOrderName(order.getName());

		if (orderExist.isPresent()) {
			throw new OrderAlreadyExist("Order is already Exist");
		}
		System.out.println("Order Saved Successfully");

		order.setOrderStatus(OrderStatus.pending);
		return orderRepository.save(order);

	}

	public Order getOrder(String name) throws OrderNotFound {

		return orderRepository.findByOrderName(name).orElseThrow(() -> new OrderNotFound("Order is not found"));
	}

	public Order updateOrder(String name, Order orderDetails) throws OrderNotFound {
		Optional<Order> orderFound = orderRepository.findByOrderName(name);

		if (orderFound.isEmpty()) {
			throw new OrderNotFound("Order is not found");
		}

		Order order = orderFound.get();

		order.setName(orderDetails.getName());
		order.setPrice(orderDetails.getPrice());
		order.setDate(orderDetails.getDate());

		return orderRepository.save(order);
	}

	public Order deleteOrder(String name) throws OrderNotFound {
		Optional<Order> findOrder = orderRepository.findByOrderName(name);

		if (findOrder.isEmpty()) {
			throw new OrderNotFound("Order is not found");

		}
		Order deleteOrder = findOrder.get();
		orderRepository.delete(deleteOrder);

		return deleteOrder;
	}
}
